<!DOCTYPE html>
<html lang="en-US">

    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        
        <meta name="description" content="Practical Cybersecurity Blog">
        
        <meta name="keywords" content="cybersecurity, infosec, bug-bounty, bugbounty, SOC, CTI, VM, Pentest, Cyber Defense">

        <title>
              Cyber Frogy - (SIEM) Advanced Detection Engineering 
        </title>

        <meta name="generator" content="Hugo 0.148.2">

        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
        

        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Roboto+Slab:wght@400;700&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <link rel="stylesheet" href="http://localhost:1313/css/main.css">
        <link rel="stylesheet" href="http://localhost:1313/css/custom.css">

        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <meta name="theme-color" content="#ffffff"></head>

    <body lang="en-US">
        <div class="container my-auto">


<section id="main-menu-pane" class="text-center main-menu">
  
  <h4><a class="menu-item" href="/">Home</a></h4>
  
  <h4><a class="menu-item" href="/posts">Blog</a></h4>
  
  <h4><a class="menu-item" href="/visualisations">Visualisations</a></h4>
  
  <h4><a class="menu-item" href="/about">About Me</a></h4>
  
  <h4><a class="menu-item" href="/repositories">My Repos</a></h4>
  
  <h4><a class="menu-item" href="/checklists">Checklists</a></h4>
  
  <h4><a class="menu-item" href="/kickstartcareer">Kickstart Career</a></h4>
  
  <h4><a class="menu-item" href="/disclaimer">Disclaimer</a></h4>
  
</section>

<header class="text-start title">
  <h1 class="title">(SIEM) Advanced Detection Engineering</h1>
</header>

<section id="category-pane" class="meta">
  
  <div class="d-flex flex-column flex-md-row justify-content-between">
    <h6 class="text-start meta">
       PUBLISHED ON AUG 28, 2025
      
      / 13 MIN READ
      
    </h6>
  </div>
  
</section>

<section id="content-pane">
  <div class="text-justify content">
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#phase-1---siem-architecture">Phase 1 - SIEM Architecture</a>
      <ul>
        <li><a href="#state-of-the-siem--industry-signals">State of the SIEM &amp; Industry Signals</a></li>
        <li><a href="#compliance-vs-tactical-siem">Compliance vs. Tactical SIEM</a></li>
        <li><a href="#siem-planning--data-strategy">SIEM Planning &amp; Data Strategy</a></li>
        <li><a href="#collection-options">Collection Options</a></li>
        <li><a href="#aggregation-parsing--enrichment">Aggregation, Parsing &amp; Enrichment</a></li>
        <li><a href="#brokers-storage-search-alerting">Brokers, Storage, Search, Alerting</a></li>
        <li><a href="#pitfalls--anti-patterns">Pitfalls &amp; Anti-patterns</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
    <li><a href="#phase-2---service-profiling">Phase 2 - Service Profiling</a>
      <ul>
        <li><a href="#collection-strategies-what-why-trade-offs">Collection Strategies (what, why, trade-offs)</a></li>
        <li><a href="#enrichment-that-moves-the-needle">Enrichment That Moves the Needle</a></li>
        <li><a href="#protocol-focused-detections">Protocol-Focused Detections</a></li>
        <li><a href="#summary-1">Summary</a></li>
      </ul>
    </li>
    <li><a href="#phase-3---endpoint-analytics">Phase 3 - Endpoint Analytics</a>
      <ul>
        <li><a href="#core-concepts--definitions">Core Concepts &amp; Definitions</a></li>
        <li><a href="#windows-logging--what-to-enable--why">Windows Logging — What to Enable &amp; Why</a></li>
        <li><a href="#linux-logging-essentials">Linux Logging Essentials</a></li>
        <li><a href="#endpoint-collection-strategies">Endpoint Collection Strategies</a></li>
        <li><a href="#events-of-interest-high-signal">Events of Interest (High-Signal)</a></li>
        <li><a href="#host-based-firewall-monitoring">Host-Based Firewall Monitoring</a></li>
        <li><a href="#login-monitoring">Login Monitoring</a></li>
        <li><a href="#os-protections-as-detectors">OS Protections as Detectors</a></li>
        <li><a href="#container-logging-playbook">Container Logging Playbook</a></li>
        <li><a href="#summary-2">Summary</a></li>
      </ul>
    </li>
    <li><a href="#phase-4---baselining--user-behavior-monitoring">Phase 4 - Baselining &amp; User Behavior Monitoring</a>
      <ul>
        <li><a href="#getting-to-know-yourself-why-baselines-matter">Getting to Know Yourself (why baselines matter)</a></li>
        <li><a href="#active-device-discovery">Active Device Discovery</a></li>
        <li><a href="#passive-device-discovery">Passive Device Discovery</a></li>
        <li><a href="#building-a-master-inventory">Building a Master Inventory</a></li>
        <li><a href="#software--scripting-monitoring">Software &amp; Scripting Monitoring</a></li>
        <li><a href="#traffic-monitoring">Traffic Monitoring</a></li>
        <li><a href="#user-monitoring">User Monitoring</a></li>
        <li><a href="#tactical-baselining--quick-start">Tactical Baselining — Quick Start</a></li>
        <li><a href="#summary-3">Summary</a></li>
      </ul>
    </li>
    <li><a href="#phase-5---tactical-siem--post-mortem-analysis">Phase 5 - Tactical SIEM &amp; Post-Mortem Analysis</a>
      <ul>
        <li><a href="#centralized-alerting-vs-product-silos">Centralized Alerting vs Product Silos</a></li>
        <li><a href="#alerting-engines--rule-patterns">Alerting Engines &amp; Rule Patterns</a></li>
        <li><a href="#sigma-mitre--sharing-detections">Sigma, MITRE &amp; Sharing Detections</a></li>
        <li><a href="#idsnipshidships--log-collection-that-helps">IDS/NIPS/HIDS/HIPS — Log Collection That Helps</a></li>
        <li><a href="#reverse-analysis--pragmatic-method">Reverse Analysis — Pragmatic Method</a></li>
        <li><a href="#tripwire-detection--early-catches">Tripwire Detection — Early Catches</a></li>
        <li><a href="#post-mortem-analytics--beacon-hunting">Post-Mortem Analytics &amp; Beacon Hunting</a></li>
        <li><a href="#events-of-interest--quick-wins">Events of Interest — Quick Wins</a></li>
        <li><a href="#summary-4">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
    
    <h2 id="introduction">Introduction</h2>
<p>I was going through the SANS material on detection engineering from multiple of their courses and I wanted to make a practical ready notes for the same. This is the output of my reading and implementing some of them into my home personal lab as well as my past companies.</p>
<p>The summary of entire process is:</p>
<p><strong>OPEN IMAGE IN A NEW TAB AND IT WILL BE THE HIGH RESOLUTION IMAGE</strong></p>
<center><img src="/images/advanced-detection-engineering.png" width="1300"/></center></br>
<h2 id="phase-1---siem-architecture">Phase 1 - SIEM Architecture</h2>
<ul>
<li><strong>Problem statement:</strong> Detection capability lags risk tolerance; people and process, not tools, are the core gap. Multiple studies and course narrative reinforce this.</li>
<li><strong>Tactical vs compliance SIEM:</strong> Compliance unlocks budget but bloats data; tactical SIEM is lean, tuned, evolving, and focused on detection value.</li>
<li><strong>Goal of SIEM:</strong> Near-real-time + historical analysis across diverse event/context sources for threat detection, compliance, and incident management.</li>
<li><strong>Plan first:</strong> Decide data-gathering strategy (input-driven, output-driven, hybrid), know expected EPS/peaks, and size storage (hot vs warm).</li>
<li><strong>Pipeline components:</strong> Collection → Aggregation/Parsing/Enrichment → (Broker) → Storage/Search → Alerting.</li>
<li><strong>Common pitfalls:</strong> No roadmap; over-collection without analysis; under-resourced teams; no use-cases.</li>
</ul>
<hr>
<h3 id="state-of-the-siem--industry-signals">State of the SIEM &amp; Industry Signals</h3>
<ul>
<li>Capability gaps persist across industries; skepticism is healthy, but patterns are consistent.</li>
<li>People and processes score worst in maturity assessments.</li>
</ul>
<p><strong>Key takeaway:</strong> Hire + grow staff; collect the right data; adopt tools that support analyst workflow. (MITRE “11 Strategies”).</p>
<p><strong>Aporoach:</strong><br>
People/Process deficits → need hiring &amp; training + repeatable processes → enables tactical (not just compliant) SIEM that maintains detection fidelity.</p>
<hr>
<h3 id="compliance-vs-tactical-siem">Compliance vs. Tactical SIEM</h3>
<ul>
<li><strong>Compliance SIEM:</strong> Often bloated &amp; slow; ambiguous mandates drive “log-everything” hoarding.</li>
<li><strong>Tactical SIEM:</strong> Focus on normal vs adverse baselines, current TTPs, and continuous tuning; may ingest less but deliver more detection value.</li>
</ul>
<p><strong>Example of Needs:</strong></p>
<ul>
<li>Financial services: Tight retention mandates → use hybrid collection with hot/warm tiers.</li>
<li>SaaS/Tech: Rapid TTP change → frequent enrichment updates &amp; scripted custom telemetry (e.g., API pulls).</li>
</ul>
<hr>
<h3 id="siem-planning--data-strategy">SIEM Planning &amp; Data Strategy</h3>
<ul>
<li><strong>Input-driven:</strong> Collect everything; pro = complete history; cons = cost, noise.</li>
<li><strong>Output-driven:</strong> Collect only what’s needed; pro = cheap/fast; con = miss unknowns.</li>
<li><strong>Hybrid:</strong> Start broad, trim high-volume low-value events; often removes 80–90% of noise; boosts performance &amp; lowers cost.</li>
</ul>
<p><strong>Sizing ingestion:</strong></p>
<ul>
<li>EPD = Events Per Day → the total number of log events you collect in a 24-hour period.</li>
<li>EPS = Events Per Second → the rate at which events are coming in per second.</li>
<li>Conversion: divide EPD by 86,400 (the number of seconds in a day) to get the average EPS.</li>
<li>Padding (2–3×): because traffic isn’t constant it spikes during business hours, logons, patch cycles, etc. You need headroom so the system doesn’t drop logs during peaks.</li>
<li>Why not vendor EPS tables? → Generic estimates vary wildly and rarely match your environment. It’s better to run a proof-of-concept (POC) or script your own counts from real logs.</li>
</ul>
<p><strong>Storage planning:</strong><br>
POC yields best accuracy; else use padded constants (~300B/firewall, ~700B/Windows event). Tier hot vs warm (aim ≥7–30 days hot).</p>
<p><strong>Approach:</strong><br>
Data strategy ↔ EPS/Storage ↔ Broker need (burst handling) ↔ Alert fidelity (less noise → better rules).</p>
<hr>
<h3 id="collection-options">Collection Options</h3>
<ul>
<li><strong>Agents:</strong> Parsing, buffering, rate-limits, encryption, priority routing, FIM, registry monitoring, NetFlow, WEF, cloud APIs. Performance varies—test.</li>
<li><strong>Agentless:</strong> Central pulls; overhead mainly auth/API; with proper config, impact is minimal.</li>
<li><strong>Syslog/API/Scripts:</strong> Scripts crucial for cloud/3rd-party + custom telemetry (e.g., nightly baselines, hashes). Non-traditional outputs (CSV lists, hashes) become logs once timestamped &amp; named at collection.</li>
</ul>
<hr>
<h3 id="aggregation-parsing--enrichment">Aggregation, Parsing &amp; Enrichment</h3>
<ul>
<li><strong>Aggregator role:</strong> Input → Filter/Enrich → Output pipeline; drop, modify, augment as needed.</li>
</ul>
<hr>
<h3 id="brokers-storage-search-alerting">Brokers, Storage, Search, Alerting</h3>
<ul>
<li><strong>Broker (Redis/RabbitMQ/Kafka):</strong> Buffers bursts, survives backend outages, smooths pipelines; Kafka for 10M+ EPS at scale; RabbitMQ = easy mgmt UI.</li>
<li><strong>Storage/tiers:</strong> Hot = SSD/SAS; Warm = SATA/tape; some SIEMs can promote warm→hot temporarily for investigations.</li>
<li><strong>Alerting patterns:</strong> SIEM native alerting, or Graylog, ElastAlert, Kibana Alerting, Watcher (polling ES; varying UX/robustness).</li>
</ul>
<hr>
<h3 id="pitfalls--anti-patterns">Pitfalls &amp; Anti-patterns</h3>
<ul>
<li>No plan/use-cases</li>
<li>Collect-all first then stall</li>
<li>Too few people</li>
<li>No continuous care &amp; feeding</li>
</ul>
<p><strong>Remedy:</strong> Staged rollout with use-cases per source.</p>
<hr>
<h3 id="summary">Summary</h3>
<table>
  <thead>
      <tr>
          <th>Dimension</th>
          <th>Context</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>CONTEXT</td>
          <td>SIEM slow, noisy, and dropping events during peaks; investigations stalled.</td>
      </tr>
      <tr>
          <td>ROLE</td>
          <td>Led SIEM re-architecture; owned data strategy, pipeline design, and alerting framework.</td>
      </tr>
      <tr>
          <td>PROCESS</td>
          <td>Assessed sources → hybrid strategy → measured EPS/peaks → broker → tuned Logstash parsers → hot/warm retention → staged rollouts.</td>
      </tr>
      <tr>
          <td>DECISION RATIONALE</td>
          <td>Hybrid preserves context but cuts noise; broker for resilience; hot storage aligned to MTTD.</td>
      </tr>
      <tr>
          <td>TOOLS / TECH</td>
          <td>Logstash, Kafka/RabbitMQ, Elasticsearch, Graylog/ElastAlert/Kibana Alerting, custom scripts.</td>
      </tr>
      <tr>
          <td>RISKS &amp; MITIGATION</td>
          <td>Peak EPS overload → broker &amp; rate limits; agent overhead → phased rollout; false positives → allow-lists.</td>
      </tr>
      <tr>
          <td>CHALLENGES</td>
          <td>Stakeholder push to “log everything”; compliance ambiguity; parser fragility. Solved with governance &amp; rubydebug test harness.</td>
      </tr>
      <tr>
          <td>RESULT / EFFECTIVENESS</td>
          <td>Search latency ↓; alert precision ↑; zero loss during peaks; faster investigations.</td>
      </tr>
      <tr>
          <td>KPIs</td>
          <td>EPS headroom; % noise trimmed; FP rate; MTTD; investigation cycle time.</td>
      </tr>
      <tr>
          <td>IMPACT BEYOND METRICS</td>
          <td>Analyst satisfaction ↑; shared mental model; tuning culture.</td>
      </tr>
      <tr>
          <td>STAKEHOLDERS</td>
          <td>SecOps, IT Ops, Compliance, App owners.</td>
      </tr>
      <tr>
          <td>SCALABILITY / REUSE</td>
          <td>Reusable per source: collect → enrich → alert.</td>
      </tr>
      <tr>
          <td>LESSONS LEARNED</td>
          <td>Start with use-cases; measure before buying; codify parsers.</td>
      </tr>
      <tr>
          <td>COLLABORATION</td>
          <td>Weekly triage with SecOps; data contracts with app teams.</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="phase-2---service-profiling">Phase 2 - Service Profiling</h2>
<ul>
<li><strong>Use what you already run:</strong> DNS/HTTP/SMTP/TLS logs are everywhere; turn them into continuous monitoring pipelines.</li>
<li><strong>Collect, enrich, detect:</strong> Choose a collection method (agent, network extraction, endpoint, or hybrid) → normalize → enrich (GeoIP/ASN, Top-1M, TI) → alert on protocol-specific behaviors.</li>
<li><strong>Mindset:</strong> “Filter hard, focus fast.” Top-1M and ASN filters slash noise (~90% DNS reduction in example), then spend CPU on the suspicious long-tail.</li>
<li><strong>SIEM ≠ mail gateway:</strong> Let purpose-built controls block; use SIEM to find what they miss (fuzzy look-alikes, spikes, abuse of “authorized” paths).</li>
</ul>
<p><strong>Approach:</strong><br>
Collection choice → field consistency → shared dashboards &amp; rules → enrichment (Top-1M, ASN, DNS lookups) → sharp filters → protocol-aware detections (SMTP fuzz, DNS NXDOMAIN/tunnels, HTTP methods/UAs, TLS quirks).</p>
<hr>
<h3 id="collection-strategies-what-why-trade-offs">Collection Strategies (what, why, trade-offs)</h3>
<ul>
<li><strong>Traditional (agents/syslog):</strong> Simple, no mirror needed; but many endpoints, per-app settings, inconsistent fields.</li>
<li><strong>Network Extraction (Zeek ecurity Onion):</strong> “Drop-and-go” breadth (DNS/HTTP/HTTPS/…); consistent logs; needs taps/SPAN and careful placement to avoid duplicates.</li>
<li><strong>Endpoint-generated net logs:</strong> Scales off-network/cloud; can add user/process context.</li>
<li><strong>Other sources (NGFW, APIs):</strong> Viable when constrained, but quality/fields vary.</li>
</ul>
<p><strong>Retention reality:</strong> Service logs are huge; many detects work with 1–3 days (pilot to prove value).</p>
<p><strong>Example:</strong></p>
<ul>
<li>SaaS/Tech: Zeek/SO near egress + endpoint net logs for roaming devices.</li>
<li>Finance/Healthcare: Post-filter SMTP and key DNS/HTTP hot for 1–7 days + warm archive; watch duplicates in hybrid designs.</li>
</ul>
<hr>
<h3 id="enrichment-that-moves-the-needle">Enrichment That Moves the Needle</h3>
<ul>
<li><strong>Forward/Reverse DNS lookups:</strong> Fill gaps (IP↔name). Use for filtering/context; mind staleness &amp; latency.</li>
<li><strong>GeoIP + ASN (e.g., Microsoft ASN 8075):</strong> Filter whole providers in one stroke instead of millions of IPs.</li>
<li><strong>Cisco Umbrella Top-1M:</strong> Tag popular domains to down-rank noise; example ~90% DNS reduction.</li>
<li><strong>SIEM translation / in-memory lookups:</strong> Query existing indices (e.g., DNS) during ingestion &amp; analysis.</li>
<li><strong>Threat intel feeds:</strong> Open/commercial; wire into Zeek/Suricata/MISP/OTX; measure hits and FPs—don’t “set and forget.”</li>
</ul>
<hr>
<h3 id="protocol-focused-detections">Protocol-Focused Detections</h3>
<h4 id="smtp-attack-ingress-insider-abuse">SMTP (attack ingress, insider abuse)</h4>
<ul>
<li>Fuzzy phishing for look-alike corp domains.</li>
<li>Enforce allow-lists of SMTP egress hosts.</li>
<li>Baseline mails/hour per authorized system; alert on spikes.</li>
</ul>
<h4 id="dns-early-rich-signal">DNS (early, rich signal)</h4>
<ul>
<li>NXDOMAIN spikes per host: Detect DGA, recon, misconfig.</li>
<li>DNS tunneling: Block direct 53 egress except resolvers; watch for recursion tunnels.</li>
<li>“New domain” + “direct IP” monitoring: Review dashboard daily.</li>
</ul>
<h4 id="httphttps-most-abused">HTTP/HTTPS (most abused)</h4>
<ul>
<li>Field-length heuristics: URLs &gt; ~250 chars, long querystrings.</li>
<li>Naked IP requests: Flag HTTP(S) hosts by IP.</li>
<li>Method anomalies: Bursty/uncommon verbs, scanners.</li>
<li>UA allow-list: Whitelist enterprise UAs.</li>
</ul>
<p><strong>Scenario tie-back:</strong> Catches vuln scans, SQLi, infected workstation traffic.</p>
<hr>
<h3 id="summary-1">Summary</h3>
<table>
  <thead>
      <tr>
          <th>Dimension</th>
          <th>Context</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>CONTEXT</td>
          <td>Needed actionable detections from common services without exploding cost/noise.</td>
      </tr>
      <tr>
          <td>ROLE</td>
          <td>Led service-log program: collection, normalization, enrichment, detections.</td>
      </tr>
      <tr>
          <td>PROCESS</td>
          <td>Deployed Zeek/SO + agents → avoided duplication → added DNS/ASN/Top-1M/TI → SMTP/DNS/HTTP rules.</td>
      </tr>
      <tr>
          <td>DECISION RATIONALE</td>
          <td>Network extraction for breadth; post-filter SMTP; Top-1M/ASN to cut noise; 24–72h retention pilot.</td>
      </tr>
      <tr>
          <td>TOOLS / TECH</td>
          <td>Zeek/SO, MISP/OTX, GeoIP/ASN, SIEM translation, ElastAlert.</td>
      </tr>
      <tr>
          <td>RISKS &amp; MITIGATION</td>
          <td>Duplicates → sensor design; TI FPs → measure; recursion tunnels → monitors.</td>
      </tr>
      <tr>
          <td>CHALLENGES</td>
          <td>Volume/retention → short hot pilot; inconsistent fields → normalize; stakeholders → quick wins.</td>
      </tr>
      <tr>
          <td>RESULT / EFFECTIVENESS</td>
          <td>Workload ↓; TTD ↓; caught phishing/tunnels/scans.</td>
      </tr>
      <tr>
          <td>KPIs</td>
          <td>% noise trimmed; NXDOMAIN outliers; first-seen reviews; SMTP spikes; TI FP rate.</td>
      </tr>
      <tr>
          <td>IMPACT BEYOND METRICS</td>
          <td>Reusable patterns; shared fields; faster investigations.</td>
      </tr>
      <tr>
          <td>SCALABILITY / REUSE</td>
          <td>Collect → enrich → detect repeatable across sites.</td>
      </tr>
      <tr>
          <td>LESSONS LEARNED</td>
          <td>Post-filter first; no duplicates; measure TI value.</td>
      </tr>
      <tr>
          <td>COLLABORATION</td>
          <td>With NetOps, Messaging, Endpoint teams.</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="phase-3---endpoint-analytics">Phase 3 - Endpoint Analytics</h2>
<ul>
<li>Windows logging (EVT vs EVTX), ETW, audit policy, PowerShell logging, Sysmon, and Sysmon-Modular.</li>
<li>Linux logging (syslog/rsyslog, facilities &amp; severities, config examples).</li>
<li>Endpoint collection strategies (agents vs agentless, WEF, Beats/NXLog).</li>
<li>Events of interest &amp; a full Windows-only detection scenario.</li>
<li>Host-based firewall monitoring (Windows Firewall, iptables).</li>
<li>Login monitoring (spikes, password spray detection).</li>
<li>OS protections for detection (EMET, grsecurity).</li>
<li>Container logging (daemon logs, drivers, sidecars, bind mounts, app-level).</li>
</ul>
<hr>
<h3 id="core-concepts--definitions">Core Concepts &amp; Definitions</h3>
<ul>
<li><strong>EVT vs EVTX:</strong> EVT = fixed fields; EVTX = XML-backed EventData/UserData with far more fields &amp; filtering.</li>
<li><strong>ETW/ETL:</strong> Kernel-level tracing; deep but noisy; often off by default.</li>
<li><strong>Sysmon:</strong> Logs process creation, hashes, network connections, registry, WMI. Use XML configs; Sysmon-Modular adds ATT&amp;CK tags.</li>
<li><strong>Linux logging:</strong> Syslog family (syslog/rsyslog/syslog-ng). Facilities (0–23), severities (0–7).</li>
<li><strong>Tactical SIEM mindset:</strong> Plant multiple tripwires with native OS logs.</li>
</ul>
<hr>
<h3 id="windows-logging--what-to-enable--why">Windows Logging — What to Enable &amp; Why</h3>
<ul>
<li><strong>Advanced Audit Policy:</strong> Use subcategories; enforce with “Force audit policy subcategory settings.”</li>
<li><strong>High-value subcategories:</strong>
<ul>
<li>Process Creation (4688 + command line).</li>
<li>Logon/Logoff (success &amp; failure).</li>
<li>Object Access (with ACLs).</li>
<li>Policy Change &amp; Filtering Platform.</li>
</ul>
</li>
<li><strong>PowerShell:</strong> Create custom channels/events; can trigger tasks.</li>
<li><strong>Sysmon config tips:</strong>
<ul>
<li>Hash all, include proc create.</li>
<li>Exclude noisy parents.</li>
<li>Log network connects except chatty apps.</li>
<li>Use Sysmon-Modular.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="linux-logging-essentials">Linux Logging Essentials</h3>
<ul>
<li><strong>Facilities/Severities:</strong> Map importance (0=Emerg…7=Debug).</li>
<li><strong>rsyslog rules:</strong>
<ul>
<li><code>=warning</code> for exact severity.</li>
<li><code>.!info</code> for inversion.</li>
<li><code>-</code> prefix to batch file writes.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="endpoint-collection-strategies">Endpoint Collection Strategies</h3>
<ul>
<li><strong>Agents recommended:</strong> Even WEF/syslog act as agents. Beats/NXLog add filtering &amp; easier management.</li>
<li><strong>WEF:</strong> Collector setup, push/pull via GPO, Windows-first destination.</li>
</ul>
<hr>
<h3 id="events-of-interest-high-signal">Events of Interest (High-Signal)</h3>
<ul>
<li><strong>Scenario proof:</strong> Windows-only chain can catch full attack lifecycle.</li>
<li><strong>Examples:</strong>
<ul>
<li>4688 unusual parent (Office → cmd.exe/powershell.exe).</li>
<li>Firewall disabled/changed.</li>
<li>New service initiation.</li>
<li>Lateral logon bursts / abnormal hours.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="host-based-firewall-monitoring">Host-Based Firewall Monitoring</h3>
<ul>
<li><strong>Windows Firewall:</strong>
<ul>
<li>Forward selective Security-channel events (drops, changes).</li>
<li>Keep full pfirewall.log locally for IR.</li>
</ul>
</li>
<li><strong>Linux iptables:</strong> Add logging chain with rate-limit, then DROP.</li>
</ul>
<hr>
<h3 id="login-monitoring">Login Monitoring</h3>
<ul>
<li><strong>Local brute/spray:</strong> Failures by source IP.</li>
<li><strong>Distributed spray:</strong> Track failed-login spikes globally.</li>
<li><strong>Profiles:</strong> Accounts on too many systems, impossible failures.</li>
</ul>
<hr>
<h3 id="os-protections-as-detectors">OS Protections as Detectors</h3>
<ul>
<li><strong>Windows EMET:</strong> Pin browser home page → instant alert on MITM.</li>
<li><strong>Linux grsecurity:</strong> Adds protections &amp; logs, but trade-offs in supportability.</li>
</ul>
<hr>
<h3 id="container-logging-playbook">Container Logging Playbook</h3>
<ul>
<li><strong>Collect:</strong> Platform/daemon, Host OS, App logs.</li>
<li><strong>Patterns:</strong>
<ul>
<li>Bind/volume mounts → host agent.</li>
<li>Sidecar agent → shared volume.</li>
<li>App-level remote logging.</li>
<li>Daemon log drivers (json-file, awslogs).</li>
</ul>
</li>
<li><strong>Kubernetes/EKS:</strong> Enable control-plane logs to CloudWatch → SIEM.</li>
</ul>
<hr>
<h3 id="summary-2">Summary</h3>
<table>
  <thead>
      <tr>
          <th>Topic</th>
          <th>Context</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>CONTEXT</td>
          <td>Needed faster, cheaper endpoint detection.</td>
      </tr>
      <tr>
          <td>ROLE</td>
          <td>Led endpoint SIEM detections; audit/Sysmon baselines; pipelines.</td>
      </tr>
      <tr>
          <td>PROCESS</td>
          <td>Enable audits/Sysmon → collect → normalize → rules → iterate.</td>
      </tr>
      <tr>
          <td>DECISION RATIONALE</td>
          <td>Built-ins first, extend wysmon; selective SIEM ingest.</td>
      </tr>
      <tr>
          <td>TOOLS</td>
          <td>Win Audit, WEF, Sysmon-Modular, rsyslog, iptables, SOF-ELK, ElastAlert, CloudWatch.</td>
      </tr>
      <tr>
          <td>RISKS</td>
          <td>Volume/noise → filters; blindspots → Sysmon; containers → volumes/sidecars.</td>
      </tr>
      <tr>
          <td>CHALLENGES</td>
          <td>Audit policy conflicts; firewall ownership; container logging.</td>
      </tr>
      <tr>
          <td>RESULT</td>
          <td>MTTD ↓ to minutes; firewall efficacy proven; IR trails ready.</td>
      </tr>
      <tr>
          <td>KPIs</td>
          <td>Time-to-first-alert; % first-seen services; login detection rate.</td>
      </tr>
      <tr>
          <td>IMPACT</td>
          <td>Better analyst intuition; faster IR; stronger trust.</td>
      </tr>
      <tr>
          <td>STAKEHOLDERS</td>
          <td>IT, SecOps, Cloud, Leadership.</td>
      </tr>
      <tr>
          <td>SCALABILITY</td>
          <td>Sysmon-Modular; first-seen patterns; container templates.</td>
      </tr>
      <tr>
          <td>LESSONS</td>
          <td>Subtle &gt; silver bullets; full logs nearby; start simple.</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="phase-4---baselining--user-behavior-monitoring">Phase 4 - Baselining &amp; User Behavior Monitoring</h2>
<ul>
<li><strong>Goal:</strong> Detect unknowns by knowing normal first; maintain organizational awareness; treat SIEM as an enabler for context, automation, and actions.</li>
<li><strong>Two pillars:</strong>
<ol>
<li>Asset visibility (devices &amp; users) via active + passive discovery.</li>
<li>Baselines (point-in-time &amp; continuous) to flag change fast.</li>
</ol>
</li>
<li><strong>Pragmatism:</strong> Full NAC is ideal but hard. Combine DHCP/OUI, AD, Zeek, NetFlow, firewall, CAM tables to classify most assets; investigate residue.</li>
</ul>
<p><strong>Approach:</strong> Inventory → Active+Passive → Master inventory (+ importance) → Tactical baselines → Change detection → User monitoring → Cloud/service add-ons.</p>
<hr>
<h3 id="getting-to-know-yourself-why-baselines-matter">Getting to Know Yourself (why baselines matter)</h3>
<ul>
<li>Baselining = known good: software, network connections, configs.</li>
<li>Compare snapshots to detect drift/anomaly.</li>
<li><strong>Change detection:</strong> any deviation = investigative needle.</li>
</ul>
<h3 id="active-device-discovery">Active Device Discovery</h3>
<ul>
<li>Strengths: rich detail; authenticated scans = “authorized” signal.</li>
<li>Weakness: slow; blind to non-responders.</li>
<li><strong>Nmap/vuln scans:</strong> Complement passive, not replace.</li>
</ul>
<h3 id="passive-device-discovery">Passive Device Discovery</h3>
<ul>
<li><strong>Sources:</strong> AD, DHCP, DNS, firewall, NetFlow, Zeek, IDS, CAM.</li>
<li><strong>Zeek software.log:</strong> lightweight device/software ID.</li>
<li><strong>DHCP+OUI:</strong> tag vendor; invalid/randomized OUIs = suspect.</li>
<li><strong>AD correlation:</strong> hostname in AD → provisional AUTH (reduces follow-ups 10×).</li>
<li><strong>Poor man’s NAC:</strong> DNS/firewall detects defaults (public NTP, direct OS updates).</li>
</ul>
<h3 id="building-a-master-inventory">Building a Master Inventory</h3>
<ul>
<li>Merge active + passive sources.</li>
<li>Grade importance (Critical–Low) to prioritize alerts.</li>
</ul>
<h3 id="software--scripting-monitoring">Software &amp; Scripting Monitoring</h3>
<ul>
<li><strong>Tells:</strong> long CLIs, base64, deny/allow lists, PowerShell run by non-powershell.exe hosts.</li>
</ul>
<h3 id="traffic-monitoring">Traffic Monitoring</h3>
<ul>
<li><strong>Connection monitoring:</strong> enumerate NetFlow IPs, subtract known inventory, escalate residue.</li>
<li>Use firewall policy IDs for context.</li>
</ul>
<h3 id="user-monitoring">User Monitoring</h3>
<ul>
<li><strong>Signals:</strong> excessive logins/failures, too many systems per user, anomalous service-account use.</li>
<li>Outcome: UEBA-lite program (simple stats + baselines).</li>
</ul>
<hr>
<h3 id="tactical-baselining--quick-start">Tactical Baselining — Quick Start</h3>
<ul>
<li>Pick scope: start with critical hosts + egress chokepoints.</li>
<li>Capture: process lists, autoruns, services, local admins, ports, tasks.</li>
<li>Schedule: daily/weekly diffs → “changed since last good.”</li>
<li>Alert: first-seen values (services, binaries, destinations).</li>
</ul>
<hr>
<h3 id="summary-3">Summary</h3>
<table>
  <thead>
      <tr>
          <th>Dimension</th>
          <th>Context</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>CONTEXT</td>
          <td>Unknown attacks &amp; shadow assets; NAC absent.</td>
      </tr>
      <tr>
          <td>ROLE</td>
          <td>Led inventory &amp; baselining; designed log-based NAC-lite; built user monitoring.</td>
      </tr>
      <tr>
          <td>PROCESS</td>
          <td>Combine DHCP/OUI, AD, Zeek, DNS, NetFlow, CAM → master inventory + baselines.</td>
      </tr>
      <tr>
          <td>DECISION RATIONALE</td>
          <td>NAC heavy; logs free; elimination round shrinks unknowns.</td>
      </tr>
      <tr>
          <td>TOOLS/TECH</td>
          <td>Nmap, Zeek, DHCP/AD, NetFlow, firewall, SIEM enrich, CAM.</td>
      </tr>
      <tr>
          <td>RISKS</td>
          <td>False auth signals → cross-source; invalid OUIs → investigate; vendor defaults → allow-list.</td>
      </tr>
      <tr>
          <td>CHALLENGES</td>
          <td>Volume + inconsistency; solved via tags &amp; schema.</td>
      </tr>
      <tr>
          <td>RESULT</td>
          <td>Unknowns ↓ ~80%; faster IR; prioritized alerts.</td>
      </tr>
      <tr>
          <td>KPIs</td>
          <td>% auto-classified devices; # first-seen triaged; MTTR for spikes.</td>
      </tr>
      <tr>
          <td>IMPACT</td>
          <td>Shared “normal” model; reusable discovery playbooks.</td>
      </tr>
      <tr>
          <td>STAKEHOLDERS</td>
          <td>Network, Identity, Helpdesk, SecOps.</td>
      </tr>
      <tr>
          <td>SCALABILITY</td>
          <td>Same framework works in cloud/VPC.</td>
      </tr>
      <tr>
          <td>LESSONS</td>
          <td>Don’t wait for NAC; use defaults; maintain baselines.</td>
      </tr>
  </tbody>
</table>
<h2 id="phase-5---tactical-siem--post-mortem-analysis">Phase 5 - Tactical SIEM &amp; Post-Mortem Analysis</h2>
<ul>
<li><strong>Center the alerts:</strong> Move from siloed consoles to a SIEM that correlates, enriches, prioritizes, and shares across teams.</li>
<li><strong>Author portable detections:</strong> Write once (Sigma), convert to your SIEM; use Uncoder.io for quick conversions.</li>
<li><strong>Make IDS great again:</strong> Integrate NIDS/NIPS/HIDS/HIPS; prefer rich JSON/binary outputs (Suricata EVE, Snort unified2→u2json/Barnyard2).</li>
<li><strong>Analyze better, not louder:</strong> Use alert engines (thresholds, spikes, droughts, first-seen); keep volumes humane.</li>
<li><strong>Reverse analysis:</strong> Safely reproduce attacks (VMs/Cuckoo), diff against baseline, harvest new events of interest.</li>
<li><strong>Tripwires that bite:</strong> Honeypots, HALO honeytokens, host-firewall traps = early, low-FP detection.</li>
<li><strong>Post-mortem wins:</strong> Hunt beacons in old logs (RITA, Flare, persistent.pl); expect IoT noise.</li>
</ul>
<hr>
<h3 id="centralized-alerting-vs-product-silos">Centralized Alerting vs Product Silos</h3>
<ul>
<li><strong>Pain:</strong> Product consoles lack context; hand-offs slow; permissions messy.</li>
<li><strong>SIEM fix:</strong> One pane with safe analyst access.</li>
<li><strong>Design:</strong> Create purpose fields (e.g., <code>ips</code> array) for fast, complete searches.</li>
<li><strong>Change monitoring:</strong> Alert on allow/deny ratio shifts after firewall changes.</li>
</ul>
<hr>
<h3 id="alerting-engines--rule-patterns">Alerting Engines &amp; Rule Patterns</h3>
<p><strong>Patterns:</strong></p>
<ul>
<li>Match/deny-list + allow-list exceptions.</li>
<li>Frequency: X in Y minutes.</li>
<li>Statistical drift: spikes/drops.</li>
<li>First-seen / new value.</li>
<li>Aggregations &amp; caps.</li>
</ul>
<p><strong>Where to run:</strong></p>
<ul>
<li>Aggregator (Logstash) for simple routes.</li>
<li>Dedicated engines (ElastAlert) for richer logic/actions.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li>Logstash route → email/PagerDuty/ES.</li>
<li>ElastAlert: alert on RDP powering on a decommissioned VM.</li>
</ul>
<hr>
<h3 id="sigma-mitre--sharing-detections">Sigma, MITRE &amp; Sharing Detections</h3>
<ul>
<li><strong>Sigma:</strong> Generic YAML analytics → convert via <code>sigmac</code>.</li>
<li><strong>Pipeline:</strong> MISP → convert → dry-run → human assess → prod.</li>
<li><strong>Uncoder.io:</strong> Quick web conversions across SIEM/EDR/NDR.</li>
</ul>
<hr>
<h3 id="idsnipshidships--log-collection-that-helps">IDS/NIPS/HIDS/HIPS — Log Collection That Helps</h3>
<ul>
<li><strong>Context:</strong> IPS = “blocked”; IDS = “saw suspicious.”</li>
<li><strong>Snort:</strong> Prefer unified2 → Barnyard2/u2json; avoid plain syslog.</li>
<li><strong>Suricata:</strong> Enable EVE JSON; split outputs (alert.json, dns.json, http.json).</li>
<li><strong>Wazuh (HIDS):</strong> JSON logs align with NIDS fields.</li>
<li><strong>Commercial:</strong> Many expose APIs/DB; watch odd field types.</li>
</ul>
<hr>
<h3 id="reverse-analysis--pragmatic-method">Reverse Analysis — Pragmatic Method</h3>
<ul>
<li><strong>Method:</strong> Baseline → replay attack → diff logs → extract EOIs.</li>
<li><strong>Tools:</strong> VM snapshots, Cuckoo Sandbox, guest log forwarding.</li>
<li><strong>Case:</strong> Unknown exe runs <code>certutil</code> CA add → author Sigma for CA installs.</li>
</ul>
<hr>
<h3 id="tripwire-detection--early-catches">Tripwire Detection — Early Catches</h3>
<ul>
<li><strong>Honeypots:</strong> Low-interaction; any contact = alert.</li>
<li><strong>Host-FW traps:</strong> Locked-down VM; inbound hit = suspicious.</li>
<li><strong>HALO honeytokens:</strong> Seed fake creds/emails; any use = malicious.</li>
</ul>
<hr>
<h3 id="post-mortem-analytics--beacon-hunting">Post-Mortem Analytics &amp; Beacon Hunting</h3>
<ul>
<li><strong>Why:</strong> “Teach old logs new tricks.”</li>
<li><strong>Tools:</strong>
<ul>
<li>RITA (Zeek) → beaconing/scans.</li>
<li>persistent.pl (Squid) → long-haul connections.</li>
<li>Flare → periodicity/dominance.</li>
</ul>
</li>
<li><strong>Performance:</strong> Run heavy jobs off-cluster.</li>
</ul>
<hr>
<h3 id="events-of-interest--quick-wins">Events of Interest — Quick Wins</h3>
<ul>
<li><strong>Windows:</strong> 4688 suspicious parents/CLIs, 7045 service creation, 4698 tasks, 1102/104 logs cleared, 4624/4625 logons.</li>
<li><strong>Network/IDS:</strong> Internal scans to honeypots; Suricata anomalies; consider IPS vs IDS context.</li>
</ul>
<hr>
<h3 id="summary-4">Summary</h3>
<table>
  <thead>
      <tr>
          <th>Dimension</th>
          <th>Context</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>CONTEXT</td>
          <td>Needed scalable, low-FP detections; SIEM centralization.</td>
      </tr>
      <tr>
          <td>ROLE</td>
          <td>Led alert strategy; built Sigma pipeline; integrated IDS/HIDS; deployed tripwires.</td>
      </tr>
      <tr>
          <td>PROCESS</td>
          <td>Correlate in SIEM → Sigma → alert engine → reverse-analysis loop → tripwires → post-mortem.</td>
      </tr>
      <tr>
          <td>DECISION</td>
          <td>Portable rules, rich IDS logs, traps, math for beacons.</td>
      </tr>
      <tr>
          <td>TOOLS</td>
          <td>Sigma, Uncoder, ElastAlert, Logstash, Suricata EVE, Snort u2json, Wazuh, Cuckoo, RITA, Flare.</td>
      </tr>
      <tr>
          <td>RISKS</td>
          <td>Alert floods → aggregation; tripwire drift → central mgmt; post-mortem load → dedicated VM.</td>
      </tr>
      <tr>
          <td>CHALLENGES</td>
          <td>Vendor field mismatch; IoT false beacons; odd APIs.</td>
      </tr>
      <tr>
          <td>RESULT</td>
          <td>Faster triage; more recon/C2 caught; shared access w/out risk.</td>
      </tr>
      <tr>
          <td>KPIs</td>
          <td>% aggregated; alerts/incident; first-seen catches; beacon hits; FP rate.</td>
      </tr>
      <tr>
          <td>IMPACT</td>
          <td>Shift to portable analytics; reusable playbooks.</td>
      </tr>
      <tr>
          <td>STAKEHOLDERS</td>
          <td>NetSec, Endpoint, IR, app teams.</td>
      </tr>
      <tr>
          <td>SCALABILITY</td>
          <td>Sigma + field-maps; tripwire templates; scheduled beacon scans.</td>
      </tr>
      <tr>
          <td>LESSONS</td>
          <td>Baseline first; aggregate; run heavy off-cluster.</td>
      </tr>
      <tr>
          <td>COLLABORATION</td>
          <td>Detection Eng + SOC + platform teams.</td>
      </tr>
  </tbody>
</table>

  </div>
</section>

<section id="tag-pane" class="meta">
  
  <div class="d-flex flex-column flex-md-row justify-content-between">
    <h6 class="text-end meta">
      
    </h6>
  </div>
  
</section>








<section id="menu-pane" class="menu text-center">
  
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      
      
      <li class="menu-item">
        <a class="menu-item" href="http://localhost:1313/posts/api-security/">&lt; prev</a>
      </li>
      

      <li class="menu-item">
        
        <span class="menu-item">&nbsp;|&nbsp;</span>
        
        <a class="menu-item" href="/posts">posts</a>
        
      </li>

      
      
    </ul>
  </nav>
  
  <h4 class="text-center mt-3"><a class="menu-item" href="http://localhost:1313/">Home</a></h4>
</section>


<footer class="text-center footer">
  <hr />
  
  <h6 class="text-center copyright">© Chintan Gurjar - <a href="mailto:chintangurjar@outlook.com">chintangurjar@outlook.com</a></h6>
  
  
  
  
  

</footer>

</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>


<script>hljs.highlightAll();</script>




<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="/js/custom.js"></script>
</body>

</html>


